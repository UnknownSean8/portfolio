---
import { Icon } from "astro-icon/components";

const currentPath = Astro.url.pathname;

const navItems = [
    {
        label: "About",
        href: "/",
    },
    {
        label: "Blog",
        href: "/blog",
    },
];
---

<header>
    <div class="header-wrapper">
        <!-- Mobile View Dock -->
        <div class="fab lg:hidden">
            <!-- a focusable div with tabindex is necessary to work on all browsers. role="button" is necessary for accessibility -->
            <div
                tabindex="0"
                role="button"
                class="btn btn-lg btn-circle btn-info bg-base-200 border-base-300"
            >
                <Icon name="mdi:hamburger-menu" size={25} />
            </div>

            <!-- close button should not be focusable so it can close the FAB when clicked. It's just a visual placeholder -->
            <div class="fab-close">
                <span class="btn btn-circle btn-lg btn-error">âœ•</span>
            </div>

            <!-- buttons that show up when FAB is open -->
            <div>
                About <a class="btn btn-lg btn-circle" href="/"
                    ><Icon
                        name="mdi:card-account-details-outline"
                        size={25}
                    /></a
                >
            </div>
            <div>
                Blog <a class="btn btn-lg btn-circle" href="/blog"
                    ><Icon name="mdi:book-open-variant" size={25} /></a
                >
            </div>

            <!-- <div>Label C <button class="btn btn-lg btn-circle">C</button></div> -->
        </div>

        <!-- Desktop View Header -->
        <div class="navbar bg-base-200 shadow-sm rounded-2xl">
            <div class="navbar-start">
                <a class="btn btn-ghost text-xl">Sean Leong</a>
            </div>
            <div class="navbar-center hidden lg:flex">
                <!-- <ul class="menu menu-horizontal px-1">
                    <li><a href="/">About</a></li>
                    <li><a href="/blog">Blog</a></li>
                </ul> -->
                <div role="tablist" class="tabs tabs-border">
                    <!-- <a role="tab" href="/" class="tab tab-active">About</a>
                    <a role="tab" href="/blog" class="tab">Blog</a> -->
                    <!-- <a role="tab" class="tab">Tab 3</a> -->
                    {
                        navItems.map((item) => {
                            const isActive =
                                item.href === "/"
                                    ? currentPath === "/"
                                    : currentPath.startsWith(item.href);

                            return (
                                <a
                                    role="tab"
                                    href={item.href}
                                    class={`tab ${isActive ? "tab-active" : ""}`}
                                >
                                    {item.label}
                                </a>
                            );
                        })
                    }
                </div>
            </div>
            <div class="navbar-end gap-2 mr-3">
                <!-- Language Change -->
                <!-- <div class="dropdown dropdown-end">
                    <div tabindex="0" role="button" class="btn rounded-field">
                        <Icon name="cif:gb" size={25} />
                    </div>
                    <ul
                        tabindex="-1"
                        class="menu dropdown-content bg-base-200 rounded-box z-1 mt-4 p-1 shadow-sm"
                    >
                        <li>
                            <button class="btn btn-ghost">
                                <Icon name="cif:gb" size={25} />
                            </button>
                        </li>
                        <li>
                            <button class="btn btn-ghost">
                                <Icon name="cif:de" size={25} />
                            </button>
                        </li>
                    </ul>
                </div> -->

                <!-- theme switcher -->
                <label class="swap swap-rotate btn">
                    <!-- this hidden checkbox controls the state -->
                    <input
                        id="themeToggle"
                        transition:persist
                        type="checkbox"
                    />

                    <!-- sun icon -->
                    <svg
                        class="swap-on w-5 h-5 fill-current"
                        xmlns="http://www.w3.org/2000/svg"
                        viewBox="0 0 24 24"
                    >
                        <path
                            d="M5.64,17l-.71.71a1,1,0,0,0,0,1.41,1,1,0,0,0,1.41,0l.71-.71A1,1,0,0,0,5.64,17ZM5,12a1,1,0,0,0-1-1H3a1,1,0,0,0,0,2H4A1,1,0,0,0,5,12Zm7-7a1,1,0,0,0,1-1V3a1,1,0,0,0-2,0V4A1,1,0,0,0,12,5ZM5.64,7.05a1,1,0,0,0,.7.29,1,1,0,0,0,.71-.29,1,1,0,0,0,0-1.41l-.71-.71A1,1,0,0,0,4.93,6.34Zm12,.29a1,1,0,0,0,.7-.29l.71-.71a1,1,0,1,0-1.41-1.41L17,5.64a1,1,0,0,0,0,1.41A1,1,0,0,0,17.66,7.34ZM21,11H20a1,1,0,0,0,0,2h1a1,1,0,0,0,0-2Zm-9,8a1,1,0,0,0-1,1v1a1,1,0,0,0,2,0V20A1,1,0,0,0,12,19ZM18.36,17A1,1,0,0,0,17,18.36l.71.71a1,1,0,0,0,1.41,0,1,1,0,0,0,0-1.41ZM12,6.5A5.5,5.5,0,1,0,17.5,12,5.51,5.51,0,0,0,12,6.5Zm0,9A3.5,3.5,0,1,1,15.5,12,3.5,3.5,0,0,1,12,15.5Z"
                        ></path>
                    </svg>

                    <!-- moon icon -->
                    <svg
                        class="swap-off w-5 h-5 fill-current"
                        xmlns="http://www.w3.org/2000/svg"
                        viewBox="0 0 24 24"
                    >
                        <path
                            d="M21.64,13a1,1,0,0,0-1.05-.14,8.05,8.05,0,0,1-3.37.73A8.15,8.15,0,0,1,9.08,5.49a8.59,8.59,0,0,1,.25-2A1,1,0,0,0,8,2.36,10.14,10.14,0,1,0,22,14.05,1,1,0,0,0,21.64,13Zm-9.5,6.69A8.14,8.14,0,0,1,7.08,5.22v.27A10.15,10.15,0,0,0,17.22,15.63a9.79,9.79,0,0,0,2.1-.22A8.11,8.11,0,0,1,12.14,19.73Z"
                        ></path>
                    </svg>
                </label>
            </div>
        </div>
    </div>
</header>

<style>
    header {
        padding: 2rem 0;
    }

    .header-wrapper {
        max-width: 1280px;
        margin-inline: auto;
        padding-inline: 2rem;
    }
</style>

<script>
    const theme = () => {
        const localStorageTheme = localStorage?.getItem("theme") ?? "";
        if (["dark", "light"].includes(localStorageTheme)) {
            return localStorageTheme;
        }
        if (window.matchMedia("(prefers-color-scheme: dark)").matches) {
            return "dark";
        }
        return "light";
    };

    const themeToggle = document.getElementById(
        "themeToggle"
    ) as HTMLInputElement;

    window.localStorage.setItem("theme", theme());

    function init() {
        if (theme() === "light") {
            themeToggle.checked = true;
            document.documentElement.setAttribute("data-theme", "cupcake");
            document.documentElement.classList.remove("dark");
        } else {
            themeToggle.checked = false;
            document.documentElement.setAttribute("data-theme", "coffee");
            document.documentElement.classList.add("dark");
        }
    }

    function switchTheme() {
        console.log("THIS should not be running " + theme());

        const element = document.documentElement;
        element.classList.toggle("dark");

        const isDark = element.classList.contains("dark");
        if (isDark) {
            document.documentElement.setAttribute("data-theme", "coffee");
            localStorage.setItem("theme", "dark");
        } else {
            document.documentElement.setAttribute("data-theme", "cupcake");
            localStorage.setItem("theme", "light");
        }
    }

    // Add an event listener to the theme toggle, which will switch the theme
    init();
    themeToggle?.addEventListener("click", switchTheme);
    document.addEventListener("astro:after-swap", init);
</script>
